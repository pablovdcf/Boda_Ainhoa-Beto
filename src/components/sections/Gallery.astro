---
interface GalleryImage {
  src: string;
  alt: string;
  width: number;
  height: number;
}

interface Props {
  title: string;
  images: GalleryImage[];
}

const { title, images } = Astro.props;
---

<section id="galeria" class="section">
  <div class="landing-container landing-container-lg">
    <header class="text-center max-w-2xl mx-auto reveal">
      <p class="text-xs uppercase tracking-[0.24em] text-slate-500">Galería</p>
      <h2 class="font-serif text-3xl md:text-4xl mt-3 text-night">{title}</h2>
    </header>

    <div id="galleryGrid" class="gallery-pro-grid reveal reveal-delay-1 mt-10">
      {
        images.map((image) => (
          <a href={image.src} class="gallery-pro-item">
            <img
              src={image.src}
              loading="lazy"
              decoding="async"
              alt={image.alt}
              width={image.width}
              height={image.height}
            />
          </a>
        ))
      }
    </div>
  </div>

  <div id="lb" class="fixed inset-0 bg-black/85 hidden items-center justify-center z-50 p-4">
    <button
      id="lbPrev"
      class="gallery-pro-control gallery-pro-control-left"
      aria-label="Imagen anterior"
    >
      ‹
    </button>
    <img id="lbImg" class="max-h-[88vh] max-w-[92vw] rounded-xl shadow-2xl" alt="" />
    <button
      id="lbNext"
      class="gallery-pro-control gallery-pro-control-right"
      aria-label="Imagen siguiente"
    >
      ›
    </button>
    <button id="lbClose" class="gallery-pro-close" aria-label="Cerrar galería">Cerrar</button>
  </div>
</section>

<script is:inline>
  (function () {
    const lb = document.getElementById("lb");
    const img = document.getElementById("lbImg");
    const prev = document.getElementById("lbPrev");
    const next = document.getElementById("lbNext");
    const close = document.getElementById("lbClose");
    if (!lb || !img) return;
    let items = [];
    let i = 0;

    function open(n) {
      if (!items.length) return;
      i = (n + items.length) % items.length;
      img.src = items[i].getAttribute("href");
      lb.classList.remove("hidden");
      lb.classList.add("flex");
      document.body.style.overflow = "hidden";
    }

    function nav(d) {
      if (!items.length) return;
      i = (i + d + items.length) % items.length;
      img.src = items[i].getAttribute("href");
    }

    function hide() {
      lb.classList.add("hidden");
      lb.classList.remove("flex");
      document.body.style.overflow = "";
    }

    function bindGrid() {
      const grid = document.getElementById("galleryGrid");
      if (!grid) return;
      items = [...grid.querySelectorAll("a")];
      items.forEach((a, idx) => {
        if (a.dataset.lbBound === "1") return;
        a.dataset.lbBound = "1";
        a.addEventListener("click", (e) => {
          e.preventDefault();
          open(idx);
        });
      });
    }

    if (prev) prev.onclick = () => nav(-1);
    if (next) next.onclick = () => nav(1);
    if (close) close.onclick = hide;
    lb.addEventListener("click", (e) => {
      if (e.target === lb) hide();
    });

    window.addEventListener("keydown", (e) => {
      if (lb.classList.contains("hidden")) return;
      if (e.key === "Escape") hide();
      if (e.key === "ArrowRight") nav(1);
      if (e.key === "ArrowLeft") nav(-1);
    });

    bindGrid();
  })();
</script>
