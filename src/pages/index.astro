---
import { getCollection, getEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/sections/Hero.astro";
import Countdown from "../components/sections/Countdown.astro";
import Agenda from "../components/sections/Agenda.astro";
import Location from "../components/sections/Location.astro";
import Gallery from "../components/sections/Gallery.astro";
import FAQ from "../components/sections/FAQ.astro";
import Footer from "../components/sections/Footer.astro";

const landingEntry = await getEntry("site", "landing");
if (!landingEntry) {
  throw new Error("Falta src/content/site/landing.json");
}

const agendaItems = (await getCollection("agenda")).sort(
  (a, b) => a.data.order - b.data.order
);
const faqItems = (await getCollection("faq")).sort(
  (a, b) => a.data.order - b.data.order
);
const recommendationItems = (await getCollection("recomendaciones")).sort(
  (a, b) => a.data.order - b.data.order
);

const locationRecommendations = recommendationItems.filter(
  (item) => item.data.category === "logistica" || item.data.category === "menu"
);

const data = landingEntry.data;
---

<BaseLayout title="Boda · Ainhoa & Alberto" description={data.heroDescription}>
  <main id="main-content" class="section-wrap py-10 sm:py-14">
    <Hero
      eyebrow={data.heroEyebrow}
      title={data.heroTitle}
      description={data.heroDescription}
      coupleNames={data.coupleNames}
      dateLabel={data.weddingDateLabel}
      venueName={data.venue.name}
      ctaLabel={data.heroCtaLabel}
      secondaryLabel={data.heroSecondaryLabel}
      ctaHref="/invite"
    />

    <Countdown
      targetIso={data.weddingDateIso}
      label={`${data.weddingDateLabel} — ${data.venue.name}`}
    />

    <Agenda title={data.agendaTitle} items={agendaItems} />

    <Location
      title={data.location.title}
      description={data.location.description}
      venueName={data.venue.name}
      venueAddress={data.venue.address}
      venueCity={data.venue.city}
      mapUrl={data.venue.mapUrl}
      photos={data.location.photos}
      recommendations={locationRecommendations}
    />

    <Gallery title={data.galleryTitle} images={data.gallery} />

    <FAQ title={data.faqTitle} items={faqItems} />

    <Footer note={data.footerNote} />
  </main>
</BaseLayout>

